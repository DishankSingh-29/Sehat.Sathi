<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Sehat Sathi</title>
    <link rel="stylesheet" href="../css/auth.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Logo and Brand -->
            <div class="auth-header">
                <div class="logo">
                    <img src="../assets/images/logo.png" alt="Sehat Sathi Logo" class="logo-img">
                    <h1>Sehat Sathi</h1>
                </div>
                <p class="tagline">Join our healthcare community</p>
            </div>

            <!-- Registration Form -->
            <form id="registerForm" class="auth-form">
                <h2>Create Account</h2>
                <p class="form-subtitle">Fill in your details to get started</p>

                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="firstName" name="firstName" placeholder="Enter first name" required>
                        </div>
                        <div class="error-message" id="firstName-error"></div>
                    </div>

                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="lastName" name="lastName" placeholder="Enter last name" required>
                        </div>
                        <div class="error-message" id="lastName-error"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">Email Address</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="error-message" id="email-error"></div>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <div class="input-with-icon">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="phone" name="phone" placeholder="Enter phone number" required>
                    </div>
                    <div class="error-message" id="phone-error"></div>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" name="password" placeholder="Create a password" required>
                        <button type="button" class="password-toggle" id="togglePassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="error-message" id="password-error"></div>
                    <div class="password-strength">
                        <div class="strength-meter">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <div class="strength-text" id="strengthText">Weak</div>
                    </div>
                    <ul class="password-requirements">
                        <li id="req-length">At least 8 characters</li>
                        <li id="req-uppercase">One uppercase letter</li>
                        <li id="req-lowercase">One lowercase letter</li>
                        <li id="req-number">One number</li>
                        <li id="req-special">One special character</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password" required>
                        <button type="button" class="password-toggle" id="toggleConfirmPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="error-message" id="confirmPassword-error"></div>
                </div>

                <div class="form-group">
                    <label for="dob">Date of Birth</label>
                    <div class="input-with-icon">
                        <i class="fas fa-calendar"></i>
                        <input type="date" id="dob" name="dob" required>
                    </div>
                    <div class="error-message" id="dob-error"></div>
                </div>

                <div class="form-group">
                    <label for="gender">Gender</label>
                    <div class="input-with-icon">
                        <i class="fas fa-venus-mars"></i>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="error-message" id="gender-error"></div>
                </div>

                <div class="form-group">
                    <label for="bloodGroup">Blood Group (Optional)</label>
                    <div class="input-with-icon">
                        <i class="fas fa-tint"></i>
                        <select id="bloodGroup" name="bloodGroup">
                            <option value="">Select Blood Group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                </div>

                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" id="terms" required>
                        <span class="checkmark"></span>
                        I agree to the <a href="#" class="terms-link">Terms of Service</a> and <a href="#" class="terms-link">Privacy Policy</a>
                    </label>
                    <div class="error-message" id="terms-error"></div>
                </div>

                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" id="newsletter">
                        <span class="checkmark"></span>
                        Subscribe to health tips and updates
                    </label>
                </div>

                <button type="submit" class="btn btn-primary btn-block" id="registerBtn">
                    <span class="btn-text">Create Account</span>
                    <div class="spinner" id="registerSpinner"></div>
                </button>

                <div class="divider">
                    <span>Or sign up with</span>
                </div>

                <div class="social-login">
                    <button type="button" class="social-btn google">
                        <i class="fab fa-google"></i>
                        <span>Google</span>
                    </button>
                    <button type="button" class="social-btn facebook">
                        <i class="fab fa-facebook-f"></i>
                        <span>Facebook</span>
                    </button>
                </div>

                <div class="auth-footer">
                    <p>Already have an account? <a href="login.html">Sign In</a></p>
                </div>
            </form>
        </div>

        <!-- Hero Image Section -->
        <div class="auth-hero">
            <div class="hero-content">
                <h2>Start Your Health Journey</h2>
                <p>Join thousands of users who trust Sehat Sathi for their healthcare needs</p>
                <div class="benefits">
                    <div class="benefit">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <h4>Secure & Private</h4>
                            <p>Your health data is encrypted and secure</p>
                        </div>
                    </div>
                    <div class="benefit">
                        <i class="fas fa-robot"></i>
                        <div>
                            <h4>AI Health Assistant</h4>
                            <p>24/7 AI-powered symptom checking</p>
                        </div>
                    </div>
                    <div class="benefit">
                        <i class="fas fa-user-md"></i>
                        <div>
                            <h4>Expert Consultations</h4>
                            <p>Connect with top healthcare professionals</p>
                        </div>
                    </div>
                    <div class="benefit">
                        <i class="fas fa-prescription"></i>
                        <div>
                            <h4>Digital Records</h4>
                            <p>Access your health records anytime</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../services/api.js"></script>
    <script src="../utils/helpers.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // Initialize registration page
        document.addEventListener('DOMContentLoaded', function() {
            // Password toggle functionality
            const togglePassword = document.getElementById('togglePassword');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            if (togglePassword) {
                togglePassword.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }
            
            if (toggleConfirmPassword) {
                toggleConfirmPassword.addEventListener('click', function() {
                    const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    confirmPasswordInput.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('fa-eye');
                    this.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }
            
            // Password strength checker
            passwordInput.addEventListener('input', function() {
                checkPasswordStrength(this.value);
            });
            
            // Form validation and submission
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const formData = {
                        firstName: document.getElementById('firstName').value.trim(),
                        lastName: document.getElementById('lastName').value.trim(),
                        email: document.getElementById('email').value.trim(),
                        phone: document.getElementById('phone').value.trim(),
                        password: document.getElementById('password').value,
                        confirmPassword: document.getElementById('confirmPassword').value,
                        dob: document.getElementById('dob').value,
                        gender: document.getElementById('gender').value,
                        bloodGroup: document.getElementById('bloodGroup').value,
                        terms: document.getElementById('terms').checked,
                        newsletter: document.getElementById('newsletter').checked
                    };
                    
                    // Validate form
                    const isValid = validateRegistrationForm(formData);
                    
                    if (!isValid) return;
                    
                    // Show loading state
                    const registerBtn = document.getElementById('registerBtn');
                    const registerSpinner = document.getElementById('registerSpinner');
                    const btnText = registerBtn.querySelector('.btn-text');
                    
                    btnText.textContent = 'Creating Account...';
                    registerSpinner.style.display = 'block';
                    registerBtn.disabled = true;
                    
                    try {
                        // Call registration API
                        const response = await authAPI.register(formData);
                        
                        if (response.success) {
                            // Store user data
                            localStorage.setItem('user', JSON.stringify(response.user));
                            localStorage.setItem('token', response.token);
                            
                            // Show success message
                            showNotification('Account created successfully!', 'success');
                            
                            // Redirect to dashboard
                            setTimeout(() => {
                                window.location.href = 'dashboard.html';
                            }, 1500);
                        } else {
                            showNotification(response.message || 'Registration failed', 'error');
                        }
                    } catch (error) {
                        console.error('Registration error:', error);
                        showNotification('An error occurred. Please try again.', 'error');
                    } finally {
                        // Reset button state
                        btnText.textContent = 'Create Account';
                        registerSpinner.style.display = 'none';
                        registerBtn.disabled = false;
                    }
                });
            }
            
            // Social login buttons
            document.querySelectorAll('.social-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const provider = this.classList.contains('google') ? 'google' : 'facebook';
                    showNotification(`${provider.charAt(0).toUpperCase() + provider.slice(1)} registration coming soon!`, 'info');
                });
            });
            
            // Helper functions
            function checkPasswordStrength(password) {
                const strengthBar = document.getElementById('strengthBar');
                const strengthText = document.getElementById('strengthText');
                const requirements = {
                    length: document.getElementById('req-length'),
                    uppercase: document.getElementById('req-uppercase'),
                    lowercase: document.getElementById('req-lowercase'),
                    number: document.getElementById('req-number'),
                    special: document.getElementById('req-special')
                };
                
                let strength = 0;
                const totalChecks = 5;
                
                // Check requirements
                const checks = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /[0-9]/.test(password),
                    special: /[^A-Za-z0-9]/.test(password)
                };
                
                // Update requirement indicators
                Object.keys(checks).forEach(key => {
                    if (checks[key]) {
                        requirements[key].classList.add('met');
                        strength++;
                    } else {
                        requirements[key].classList.remove('met');
                    }
                });
                
                // Calculate strength percentage
                const strengthPercentage = (strength / totalChecks) * 100;
                strengthBar.style.width = `${strengthPercentage}%`;
                
                // Update strength text and color
                let color, text;
                if (strengthPercentage < 40) {
                    color = '#e74c3c';
                    text = 'Weak';
                } else if (strengthPercentage < 70) {
                    color = '#f39c12';
                    text = 'Fair';
                } else if (strengthPercentage < 90) {
                    color = '#3498db';
                    text = 'Good';
                } else {
                    color = '#2ecc71';
                    text = 'Strong';
                }
                
                strengthBar.style.backgroundColor = color;
                strengthText.textContent = text;
                strengthText.style.color = color;
            }
            
            function validateRegistrationForm(formData) {
                let isValid = true;
                
                // Clear all errors
                clearAllErrors();
                
                // First name validation
                if (!formData.firstName) {
                    showError('firstName-error', 'First name is required');
                    isValid = false;
                }
                
                // Last name validation
                if (!formData.lastName) {
                    showError('lastName-error', 'Last name is required');
                    isValid = false;
                }
                
                // Email validation
                if (!formData.email) {
                    showError('email-error', 'Email is required');
                    isValid = false;
                } else if (!isValidEmail(formData.email)) {
                    showError('email-error', 'Please enter a valid email address');
                    isValid = false;
                }
                
                // Phone validation
                if (!formData.phone) {
                    showError('phone-error', 'Phone number is required');
                    isValid = false;
                } else if (!isValidPhone(formData.phone)) {
                    showError('phone-error', 'Please enter a valid phone number');
                    isValid = false;
                }
                
                // Password validation
                if (!formData.password) {
                    showError('password-error', 'Password is required');
                    isValid = false;
                } else if (formData.password.length < 8) {
                    showError('password-error', 'Password must be at least 8 characters');
                    isValid = false;
                } else if (!isStrongPassword(formData.password)) {
                    showError('password-error', 'Password does not meet requirements');
                    isValid = false;
                }
                
                // Confirm password validation
                if (!formData.confirmPassword) {
                    showError('confirmPassword-error', 'Please confirm your password');
                    isValid = false;
                } else if (formData.password !== formData.confirmPassword) {
                    showError('confirmPassword-error', 'Passwords do not match');
                    isValid = false;
                }
                
                // Date of birth validation
                if (!formData.dob) {
                    showError('dob-error', 'Date of birth is required');
                    isValid = false;
                } else if (!isValidDOB(formData.dob)) {
                    showError('dob-error', 'You must be at least 13 years old');
                    isValid = false;
                }
                
                // Gender validation
                if (!formData.gender) {
                    showError('gender-error', 'Please select your gender');
                    isValid = false;
                }
                
                // Terms validation
                if (!formData.terms) {
                    showError('terms-error', 'You must agree to the terms and conditions');
                    isValid = false;
                }
                
                return isValid;
            }
            
            function isValidEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            function isValidPhone(phone) {
                const re = /^[+]?[\d\s\-()]+$/;
                return re.test(phone) && phone.replace(/\D/g, '').length >= 10;
            }
            
            function isStrongPassword(password) {
                const checks = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /[0-9]/.test(password),
                    special: /[^A-Za-z0-9]/.test(password)
                };
                
                return Object.values(checks).filter(Boolean).length >= 4;
            }
            
            function isValidDOB(dob) {
                const birthDate = new Date(dob);
                const today = new Date();
                const age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    return age - 1 >= 13;
                }
                return age >= 13;
            }
            
            function showError(elementId, message) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = message;
                    element.style.display = 'block';
                }
            }
            
            function clearError(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = '';
                    element.style.display = 'none';
                }
            }
            
            function clearAllErrors() {
                const errorElements = document.querySelectorAll('.error-message');
                errorElements.forEach(element => {
                    element.textContent = '';
                    element.style.display = 'none';
                });
            }
            
            function showNotification(message, type) {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                    <button class="close-notification">&times;</button>
                `;
                
                // Add to document
                document.body.appendChild(notification);
                
                // Close button
                notification.querySelector('.close-notification').addEventListener('click', () => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                });
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'slideOut 0.3s ease';
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 5000);
            }
            
            // Check if user is already logged in
            const token = localStorage.getItem('token');
            if (token) {
                window.location.href = 'dashboard.html';
            }
        });
    </script>
</body>
</html>